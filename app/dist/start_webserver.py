#!/usr/bin/env python38
#-*- encoding: UTF-8 -*-

#Program imports
import os, sys, json, signal, argparse

#Check debug settings.
json_file = open("debug-settings.json")
debugvar = json.load(json_file)
debug_setting = debugvar["debug_mode"]
json_file.close()

#stop program agrparse
parser = argparse.ArgumentParser()
parser.add_argument("s", default='0', type=int)
args = parser.parse_args()

if args.s == 0:
    pass
elif args.s == 1:
    print("Shutting webserver down...")
    for line in os.popen("ps ax | grep webserver.py"):
        fields = line.split()
        pid = fields[0]
        os.kill(int(pid), signal.SIGKILL)

# start web svr
if debug_setting == "ON":
    os.popen("nohup python3 ../web_app/debug_webserver.py > web_app/web_logs/webserver_debug_log.out 2>&1 &")
    pass
elif debug_setting == "OFF":
    os.popen("nohup python3 ../web_app/webserver.py > web_app/web_logs/webserver_debug_log.out 2>&1 &")
else:
    print("Something went wrong with the program, please check the webserver logs for more...")
