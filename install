#!/usr/bin/bash

# OPEN TESTING V1 - WHITE-SPACE INSTALLER

echo """

        ┏━━━┓╋╋╋╋╋╋╋╋╋╋┏━━━━┓╋╋╋╋┏┓
        ┃┏━┓┃╋╋╋╋╋╋╋╋╋╋┃┏┓┏┓┃╋╋╋┏┛┗┓
        ┃┃┃┃┣━━┳━━┳━┓╋╋┗┛┃┃┣┻━┳━┻┓┏╋┳━┓┏━━┓
        ┃┃┃┃┃┏┓┃┃━┫┏┓┳━━┓┃┃┃┃━┫━━┫┃┣┫┏┓┫┏┓┃
        ┃┗━┛┃┗┛┃┃━┫┃┃┣━━┛┃┃┃┃━╋━━┃┗┫┃┃┃┃┗┛┃
        ┗━━━┫┏━┻━━┻┛┗┛╋╋╋┗┛┗━━┻━━┻━┻┻┛┗┻━┓┃
        ╋╋╋╋┃┃╋╋╋╋╋╋╋╋╋╋╋╋╋╋╋╋╋╋╋╋╋╋╋╋╋┏━┛┃
        ╋╋╋╋┗┛╋╋╋╋╋╋╋╋╋╋╋╋╋╋╋╋╋╋╋╋╋╋╋╋╋┗━━┛

                   INSTALLER
                v1 WHITE-SPACE



Pease wait while 0penTesting installs...
"""
if [ "$PREFIX" = "/data/data/com.termux/files/usr" ]; then
    INSTALL_DIR="$PREFIX/usr/share/doc/0penTesting"
    BIN_DIR="$PREFIX/bin/"
    BASH_PATH="$PREFIX/bin/bash"
    TERMUX=true

    pkg install -y git python3 python3-pip
    pip3 install -r app/dist/requirements.txt
    echo "Making files executable..."
	chmod +x app/application
	chmod +x app/web_app/webserver.py
	chmod +x app/web_app/debug_webserver.py
	chmod +x app/dist/start_webserver.py
	chmod +x app/dist/update_mgr.py
	echo "Moving install files..."
	mv install app/dist/
elif [ "$(uname)" = "Darwin" ]; then
    INSTALL_DIR="/usr/local/0penTesting-Framework"
    BIN_DIR="/usr/local/bin/"
    BASH_PATH="/bin/bash"
    TERMUX=false
    #apple 


else
    INSTALL_DIR="$HOME/.0penTesting-Framework"
    BIN_DIR="/usr/local/bin/"
    BASH_PATH="/bin/bash"
    TERMUX=false

    sudo apt-get install -y git python3 python3-pip
	echo "Installing apt's..."
	sudo apt-get install python3 python3-pip 
	echo "Installing pip's..."
	pip3 install -r app/dist/requirements.txt
	echo "Making files executable..."
	chmod +x app/application
	chmod +x app/web_app/webserver.py
	chmod +x app/web_app/debug_webserver.py
	chmod +x app/dist/start_webserver.py
	chmod +x app/dist/update_mgr.py
	echo "Moving install files..."
	mv install app/dist/
fi
echo "Checking directories...";
if [ -d "$INSTALL_DIR" ]; then
    echo "A directory with 0penTesting was found! Do you want to replace it? [Y/n]:" ;
    read -r mama
    if [ "$mama" = "y" ]; then
        if [ "$TERMUX" = true ]; then
            rm -rf $INSTALL_DIR
            rm "$BIN_DIR 0penTesting-Framework/"
        else
            sudo rm -rf $INSTALL_DIR
            sudo rm "$BIN_DIR 0penTesting-Framework/"
        fi
    else
        echo "[✘] If you want to install you must remove previous installations [✘] ";
        echo "[✘] Installation failed! [✘] ";
        exit
    fi
fi

echo "Cleaning up old directories...";
if [ -d "$ETC_DIR/0penTesting-Framework" ]; then
    echo "$DIR_FOUND_TEXT"
    if [ "$TERMUX" = true ]; then
        rm -rf "$ETC_DIR/0penTesting-Framework"
    else
        sudo rm -rf "$ETC_DIR/0penTesting-Framework"
    fi
fi

echo "Coping files and finealizing...";

git clone https://github.com/ZeroPenSecurity/0pentesting-Framework $INSTALL_DIR;

if [ "$TERMUX" = true ]; then
    cp $INSTALL_DIR $BIN_DIR
else
    sudo rm -rf ../0pentesting-Framework/
    export PATH=$PATH:$INSTALL_DIR/app/application
fi


if [ -d "$INSTALL_DIR" ] ;
then
    echo "Tool installed successfully!";
else
    echo "[✘] Installation failed! [✘] ";
    exit
fi
